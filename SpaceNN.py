import time

import keyboard

from deap import base, algorithms
from deap import creator
from deap import tools

from neuralnetworkspace import NNetwork

import random
import matplotlib.pyplot as plt
import numpy as np

import gymnasium as gym

haveh = False

env = gym.make('Pendulum-v1', render_mode='rgb_array')

NEURONS_IN_LAYERS = [3, 9, 8, 10, 9, 4, 2, 1]               # распределение числа нейронов по слоям (первое значение - число входов)
network = NNetwork(*NEURONS_IN_LAYERS)

LENGTH_CHROM = NNetwork.getTotalWeights(*NEURONS_IN_LAYERS)    # длина хромосомы, подлежащей оптимизации
LOW = -2.0
UP = 2.0
ETA = 73

# константы генетического алгоритма
POPULATION_SIZE = 30   # количество индивидуумов в популяции
P_CROSSOVER = 0.9       # вероятность скрещивания
P_MUTATION = 0.15        # вероятность мутации индивидуума
MAX_GENERATIONS = 34   # максимальное количество поколений
HALL_OF_FAME_SIZE = 2

hof = tools.HallOfFame(HALL_OF_FAME_SIZE)

RANDOM_SEED = 42
random.seed(RANDOM_SEED)

creator.create("FitnessMax", base.Fitness, weights=(1.0,))
creator.create("Individual", list, fitness=creator.FitnessMax)


toolbox = base.Toolbox()
toolbox.register("randomWeight", random.uniform, -0.69, 0.69)
toolbox.register("individualCreator", tools.initRepeat, creator.Individual, toolbox.randomWeight, LENGTH_CHROM)
toolbox.register("populationCreator", tools.initRepeat, list, toolbox.individualCreator)

population = toolbox.populationCreator(n=POPULATION_SIZE)

# best = [0.31943377891217734, 0.07328168165767654, 0.907071754449956, 0.44917557035160194, 0.2969862811124416, 0.6181740768937611, -0.25621563807643144, -0.024422329888297498, -0.90748906840793, -0.7808934319043166, -0.37400363411841225, -0.7740152345239406, 0.6443929690596482, -0.5112986144415258, 0.04396137560151769, -0.10354722530339802, -0.8312759266912653, 0.2720618962381749, 0.868337142308675, -0.6522830428879501, 0.15731986147944974, -0.13770240678977216, 0.4045566757762496, -0.25964012786471724, -0.24857443244997046, -0.7625742685362034, 0.8377880347412863, -0.5836048573222893, -0.4847728959549794, -0.7397521841188758, 0.32279118707959564, 0.8640201874844033, -0.12066339205313342, 0.5325026419245145, 0.2548150822690388, 0.9560229564379894, -0.6485559641525286, -0.43255965947605957, -0.8679871502643188, 0.7900150519300062, 0.5830597165590864, -0.385295083668304, 0.2544048127729425, -0.22411152018290595, 0.09255614029770003, -0.541201976769609, 0.26115138897370244, 0.08072085986517177, 0.2593190826867322, 0.8883431903455361, 0.7796107212779162, -0.5378836771323372, -0.07261338571270193, -0.5228343147462956, 0.4137778939665692, -0.8623915069567465, -0.8103831157636673, 0.43866321083101256, -0.7556646481921069, -0.12163680955431355, 0.6618917996307523, -0.6489001812793264, -0.4438673236584877, -0.9772418562721341, -0.4191947891247484, -0.3366795076774944, -0.7914754444322812, 0.2260641582190413, -0.8227689790451147, -0.06428319736714565, -0.7370557287754842, -0.24415708046145962, 0.4919822154402261, -0.6819674553787045, 0.5820830599420387, 0.7993625387872256, -0.5994986102411206, -0.7484030472036854, 0.17023733872419833, 0.14761270063136278, -0.4472270006285969, 0.1702891720386071, -0.7267637782871006, -0.7677587462533315, -0.34086494984118587, 0.12304323440336905, 
# -0.0429052274253271, 0.46966684683793947, -0.5263722623270811, -0.9331971640169677, -0.0784545909033263, 0.5977591832873966, 0.7033023077565912, -0.37161554418559406, -0.03234783486749662, -0.29122226317037053, -0.015022473429989913, 0.9487719121842537, 0.2833321894892509, -0.4112740140146557, -0.8560987844570749, 0.4486290875162, 0.921633012463798, 0.6595232510700639, -0.2234471335852922, 0.011492549127909202, -0.09621890257448479, -0.5141117591196409, -0.493760362049792, 0.10516287446171814, -0.7317694882949101, 0.5098690350131517, -0.4252220792310021, 0.5058091385166982, -0.15748438136521792, -0.26598553184738627, 0.31695380797223904, 0.7940812753793721, -0.4552500799158674, -0.11183140363125452, -0.25870682715679866, 0.12891986129086766, 0.6805479179121449, -0.4303698089511832, 0.5719171960058624, -0.5678067325722138, 0.2811494894939657, -0.8036220208100988, 0.018357886938884616, -0.7835187243966785, 0.1074481492360235, 0.3204685269176022, -0.20330842005508598, 0.9711267491044027, -0.06817810728903868, -0.5463434339975104, 0.04244204044371521, 0.057705384308798846, -0.985552764946506, 0.7726553250050188, -0.17183497393081065, -0.10583065962703023, 0.0038044908652734733, -0.4073839127955744, -0.36615338806360764, -0.22408445672289068, -0.9178099318567585, -0.6934342223459518, 0.2015679185439924, -0.004436632332549203, 0.10347064791928841, -0.9477887937283416, -0.8796829750457092, -0.449813274106987, -0.25729082867565445, 0.5734270902232257, -0.6278181944451011, -0.8128670548121791, 0.554578175979453, -0.8475148742962559, -0.42755717040811814, 0.8859244164156993, -0.020629876320629875, -0.9025185270522631, -0.9706734790894473, -0.3334982407060639, -0.7162236073764113, -0.8352026771246478, 0.730282360714315, -0.41134619827497915, 0.409262671505191, -0.7645474468802149, -0.08213873985837733, 0.5461451145394517, 0.791264969643976, 0.6501234183332124, 0.40512786229681513, -0.28447803981643316, 0.03800649367721537, 0.19026580845181376, 0.1316936014349586, 0.5525149426997606, 0.9492390838251206, 0.9588713839102911, 0.45304836395081916, 0.8946466152350372, 0.015301137792870873, -0.10262479347825085, 0.05005862803504707, 0.29811833088062045, -0.6727925540818341, 0.8248024897939735, -0.9295182981058236, 0.4820724694587788, 0.9712731851548723, -0.9263046861520594, -0.8599191668671764, -0.4446145215234402, 0.3414929445764964, 0.16099757998973976, -0.9209600511934766, 0.6240231166375723, -0.8784577597864689, 0.2642317211405276, -0.5530393536127697, 0.6725444731259915, -0.5420751904358043, -0.9752387374814331, 0.726135995908779, -0.41641137287086605, -0.2286647635723663, 0.21389631885684507, 0.47252197215217895, 0.04889187538343602, -0.9355345283590093, -0.43940520793740223, 0.05647821861227181, -0.4944420080011056, 0.6934667288494112, -0.9119495006864927, -0.21885949729996526, 0.6740545597723634, 0.8216848436177558, 0.9973500300862933, 0.40459238804409514, 0.3343615077535671, 0.256845707791179, -0.8059956660281175, 0.6918018060692961, 0.44486173907029447, 0.27743003928904864, 0.5228288604709347, 0.24650541940782902, 0.36198943003651984, 0.6132300617510676, -0.42163151722358216, -0.6932150967129266, -0.7465443646823537, 0.901682987734901, -0.4545960861136415, 0.3488533405183208, -0.4050586311362865, 0.9089867414989956, -0.6063647019802437, -0.1772880442815588, 0.6520903118349228, 0.2992680332832582, 0.7399974771687172, -0.5083676420145632, 0.9041632326627683, 0.9568659092113134, -0.4079993288503623, 0.6461606406770184, -0.011750390532703159, -0.4654401812431595, 0.15245304131711146, -0.07480665580138329, -0.8607159860576918, 0.17130605143424707, 0.6033904203362954, -0.63526801186649, -0.8399941048344901, 0.7158122162806445, -0.062715609233062, -0.9967417283370524, -0.7835150840506642, 0.7864715340526652, -0.7720914367807987, -0.12291855352162817, -0.7128713713918364, -0.6919081149366066, 0.21509810118670197, 0.28584339211277127, 0.6240150417353962, -0.5458219402160347, 0.2717611600883991, 0.7595915379641727, -0.12781386262261912, 0.9346920445466582, 0.8416485476649096, 0.07290726516724269, -0.7935492436236299, 0.9809251874671595, -0.6816502197501203, -0.5139969162887223, -0.029361605750942397, 0.8835832876835783, 0.4011016348377274, 0.0948647318138514, -0.8275230623985056, 0.5010111428703402, 0.8762203230907186, 0.4751120739920438, 0.7885964871236282, -0.319743571861585, -0.5484134294905415, -0.19187603153554958, 0.5921626963612291, -0.16030599245175736, 0.8464223109167077, -0.4777715577185461, -0.02667982134932606, -0.2387377265907571, -0.5261855695184523, 0.4948830579188275, -0.03896712966303029, -0.3963752408315946, -0.1192565912408875, 0.770194236316661, -0.1709101801025058, -0.45329092516706737, 0.8954363911180989, 0.2402289585069376, -0.6539121478192755, 0.6618242169751357, 0.6607542714386655, -0.5829500251279913, 0.6457748015938037, -0.12022861954832473, 0.9668989777139149, -0.7795267140439017, 0.18817345591447784, -0.3377759997046501, 0.2700926018336505, 0.5903042183007154, 0.06796547664200314, -0.882950896642713, -0.018619505240800405, 0.5264446678883992, 0.4884582300865303, 0.3315853332332177, 0.7112444798363156, -0.3834249668049318, -0.12021457092235471, -0.006228412899063673, 0.40253990717114146, 0.6209756607489829, 0.8977666859415538, -0.7549704888233661, -0.70624437335772, 0.7839567927894573, 0.5942937734691931, 0.9531656502436703, 0.4315420046184765, 0.4362271717992668, -0.5527207657707954, -0.3788133505398585, -0.955974521779043, -0.149069361430076, 0.9087058602843741, -0.08857006177891086, -0.5735529529578396, 0.8917756290173495, -0.6294350854070154, -0.1788898723013121, -0.7792397894619947, 0.457941143628842, 0.6939556108192944]
# [3, 9, 8, 10, 9, 4, 2, 1]
# best = [0.6856996052505693, 0.7489605928405499, 0.9291257294597306, 0.20217072769581268, 0.2783545816614803, 0.5782972757426244, -0.7030905812542747, 0.29461960074987537, -0.6037466246218871, -0.7061854581973701, -0.6687338488129214, -0.9092596622477331, 0.4048750722815106, -0.08105520261512425, 0.00650740980069929, 0.869711022333377, -0.8320960837445854, 0.4720245229897634, -0.027135629341778614, -0.5440075904428285, -0.8981911857806468, 0.4300640073485059, 0.5601904020601629, 0.3900990614268528, -0.7982176328734398, 0.6696407406990685, 0.2271754179514422, 0.13215011460153478, -0.785060873658231, 0.8721646417915003, -0.2311271237098062, -0.9561440876983236, 0.1782111288824597, -0.259981994059804, -0.5218940374945776, -0.6818218617268029, 0.7376964270989875, -0.5219581669467637, 0.19601765311559985, -0.43823536838583954, 0.9686594167697782, 0.26627893591868856, -0.2614024073849815, -0.8002007418184078, 0.025505943404493477, 0.40328978340911, -0.8798926945677041, 0.2843349422127577, -0.7695570710703669, -0.3569206468112533, -0.31032995666170266, 0.25367928768809467, 0.35961377576126924, -0.9725168925362458, 0.998704102826306, 0.28909839881541566, -0.926330266412642, 0.2575193564186423, -0.8887702301790614, 0.9734530499062806, -0.20835180929672845, -0.8458771976115143, 0.6441959100042108, -0.705491334937449, 0.12357309621676549, 0.7912293061763369, -0.834716379141115, 0.26830308113133927, 0.4077176018031046, -0.3437156772782172, 0.539046040383334, 0.45963298209953646, 0.2526220932164659, 0.4038989975234505, -0.7287750970319347, 0.49209079799578903, -0.19136603947194403, -0.016742349283500824, 0.9018148500656931, -0.880054068449019, -0.1435797359550191, 0.20163583692422676, 0.8143509749338689, -0.007997886587481517, 0.649526359554757, -0.5774996625609282, -0.5998272860517311, 0.9895699985758838, 0.48958454520427436, 0.45856060252810993, 0.09393086915324826, 0.8290668294158572, -0.3169856390173078, 0.012717334779191625, 0.032886548839621714, 0.11330710619896062, -0.3622045656548687, -0.049593023432360744, 0.8924119692016635, 0.2304373739112792, -0.6763134344209438, 0.4958791064751762, 0.17353321990303738, -0.7960390507505759, -0.9884519800848913, 0.698055461696949, 0.12359901581488625, -0.42786755058277093, -0.5102208212537969, 0.14862623629467808, 0.7596242313101633, 0.3278369876590847, -0.517401740231433, 0.8513686700362237, -0.3614946929521877, -0.3540265767463766, -0.12875507603919872, 0.8124308847546456, 0.9324670920514082, -0.0189001639253025, -0.813700856056813, -0.4149636546040313, 0.16616351643586832, 0.6462827498696452, 0.008009846156158074, 0.8758615951519438, 0.880152142192762, -0.33656100713102377, -0.40822296184568585, 0.657294017990385, 0.9918482965474585, -0.9949123906653152, 0.9831193276598673, -0.48416011885095905, 0.07501216168607058, -0.7280511170412347, 0.5626062578086576, -0.8561159242928473, -0.6537708842542282, 0.2015852320617792, 0.9727974408780888, -0.42659113963384454, -0.9264380445147811, 0.7139088433601105, -0.037281605973187575, -0.49717763244895313, 0.9554994709985932, 0.09983430763928054, 0.2622659891219174, -0.026594454221564836, -0.811155548894569, -0.7398741046350666, -0.6257223183060534, -0.26000261327895313, -0.6756562722386388, 0.9654026009680383, 0.7246053608370221, -0.7728579396170004, 0.7803616716583873, -0.947835546118671, 0.6554973871116546, -0.6947557755470906, 0.2627087520875884, -0.7910088394070541, 0.5439381904255443, 0.10086355051033842, -0.18894729342107575, 0.8025079588657097, 0.6072577497334053, 0.00010120438454294667, 0.3413094056983704, 0.8510766870554844, -0.4785443320916885, -0.6065257061672736, 0.3849217916913153, 0.10316934163659025, 0.6082910524737145, -0.4856765716117391, -0.11487248757610406, 0.5465177901749545, 0.5331452833418462, 0.3971624307200997, 0.18655044175777435, -0.693860372132992, -0.8181614560880159, 0.5956783333567768, -0.011950970307695097, -0.5891288950244531, -0.6196515333326846, 0.2597608401138756, 0.616854323241283, -0.7373357991562393, -0.37550938472833234, 0.43188940785949165, 0.8962481815642497, 0.6236039190811096, 0.896139700582353, 0.48171861793369186, -0.9424723920495874, 0.5175712914598053, -0.9841544926154204, -0.20972533286152376, -0.20387725681269334, -0.7846740696393507, 0.49786869983701465, -0.28949174808985567, 0.9044687389090329, -0.21646648494362458, 0.745413043606188, 0.6174022056795392, -0.8762085713844125, 0.21437082695470683, 0.1912128723542858, -0.751906777254159, -0.4206953435943194, 0.9069529599983229, -0.6147674428966319, -0.7733860545774277, 0.6186436804589557, -0.046534391568512495, -0.08672358179832144, 0.8300503998562976, -0.6622436068859109, -0.6728945324071935, 0.8113226098658695, 0.1560110827741015, 0.28790410126233423, -0.12101576452457366, 0.2725006990140456, 0.07851407694200263, 0.33688815898646124, 0.16709003550290175, -0.30086243866671364, 0.6701061654382913, -0.90918679758676, -0.7053679656156655, -0.4396997833445794, 0.029557751224059042, 0.32696654373972245, -0.5349140643915964, -0.47725349949443785, 0.3702190984599355, -0.27139040654851726, -0.02442194691776449, -0.2039304320502441, -0.9320451649881506, 0.3656010368751175, -0.36811258973430266, 0.7929313344792166, 0.8091745824514345, 0.8531503783327359, 0.6125988471480888, 0.6780822289482475, -0.3488745023430014, 0.5543772314844329, 0.29907838083006255, -0.41189961510055173, -0.8871747449829082, 0.946729714461643, 0.579919181481838, -0.8089313116183404, -0.6454622487149794, 0.08477600729182913, 0.5409332811966389, 0.13252042873740622, -0.28852416642968715, -0.9400097579081991, -0.3149347140567143, 0.13510951867770774, -0.8730872862212279, 0.9797080624920373, -0.5031921251039865, -0.19526270555429873, -0.9049415524870483, -0.200779846832422, -0.08916179762648477, -0.978636958952395, -0.6062117297211547, 0.5643840017287359, -0.3067074363981812, -0.3500390700154681, 0.44605492167310623, -0.4745723817836557, -0.16032597305366922, 0.685093529600244, 0.2934405634802949, -0.43220534249117004, -0.7764882635250749, 0.3602366365582277, 0.16938607097299307, -0.08912620384213163, 0.18234775241880696, -0.47146626717804074, 0.8565013873783389, 0.188617559502693, -0.6189636796489089, -0.7909295112683887, 0.13415688794474245, 0.31107751766311253, 0.5752236711262808, 0.9354807950816385, -0.04794771682810525, -0.8980251102948731, 0.3046532305851382, 0.04754257824990147, -0.4389615761022843, 0.5588012615884339, -0.11310048687035269, -0.009375683573490196, 0.7163644067320056, 0.5121383701362379, 0.9503950766819611, -0.886759554533481, -0.03524953647310358, -0.7465337276116222, -0.2267737208029592, -0.007105629508197098, 0.5484599620221725, -0.3692346766546808, 0.5971030052800193, -0.4312210154596431, 0.703620587468266, -0.0015250365688702083, 0.22966943996395045, 0.526130136161438, 0.8478466680230805, 0.458952471786679, -0.6410464974963838, 0.11851628586340851, 0.7873437976370841, -0.40623571279695425, 0.4833583576610619, 0.9023102450851155, -0.671661803417381, -0.7273398695133453, 0.048579048753286835, 0.16579018377549679, -0.3564169341774131, -0.3623375747520542, -0.24907705011103412, -0.8711973551533092, 0.19429578442635334, 0.2079015247769732, 0.2910476880467328, -0.49069979708015105, 0.8820824619987238, 0.2717364712617947, 0.5812560580234266, -0.2212360427437349, 0.7602143766729793, 0.08243186276820125, 0.5725784152507734, -0.5991368234710457, -0.8024129165507514, -0.1630094115021229, -0.316664434588971, -0.8177765774892591, 0.8517540330038853]

# network.set_weights(best)

if not haveh:
    def getScore(individual):
        network.set_weights(individual)

        observation = env.reset()
        obs = True
        actionCounter = 0
        totalReward = 0

        done = False
        while not done and actionCounter < 500:
            if obs:
                if len(observation[0].tolist()) == 3:
                    actionCounter += 1
                    action = [float(network.predict(observation[0]))]
                    observation, reward, done, _, info = env.step(action)
                    obs = False
                    totalReward += reward if not done else -16
            else:
                actionCounter += 1
                action = [float(network.predict(observation))]
                observation, reward, done, _, info = env.step(action)
                obs = False
                totalReward += reward if not done else -16
                
        return totalReward,


    toolbox.register("evaluate", getScore)
    toolbox.register("select", tools.selTournament, tournsize=2)
    toolbox.register("mate", tools.cxSimulatedBinaryBounded, low=LOW, up=UP, eta=ETA)
    toolbox.register("mutate", tools.mutPolynomialBounded, low=LOW, up=UP, eta=ETA, indpb=1.0/LENGTH_CHROM)

    stats = tools.Statistics(lambda ind: ind.fitness.values)
    stats.register("max", np.max)
    stats.register("avg", np.mean)


    #algelitism.eaSimpleElitism
    #algorithms.eaSimple
    population, logbook = algorithms.eaSimple(population, toolbox,
                                            cxpb=P_CROSSOVER,
                                            mutpb=P_MUTATION,
                                            ngen=MAX_GENERATIONS,
                                            halloffame=hof,
                                            stats=stats,
                                            verbose=True)

    maxFitnessValues, meanFitnessValues = logbook.select("max", "avg")

    best = hof.items[0]
    print(best)

    plt.plot(maxFitnessValues, color='red')
    plt.plot(meanFitnessValues, color='green')
    plt.xlabel('Поколение')
    plt.ylabel('Макс/средняя приспособленность')
    plt.title('Зависимость максимальной и средней приспособленности от поколения')
    plt.show()

# best = [-0.8442491612852486, -0.8081501897101935, 0.8974097465378366, 0.6548599993389153, 0.3579978979143513, 0.9870698501861881, 0.5094275152315094, 0.3183208509427937, -0.5525485844187733, -0.2601593449220088, 0.4830843427460079, 0.220056984975593, -0.6724321776252805, -0.044061559646763726, -0.7363987388196216, -0.9926134754286797, -0.9090263625668589, -0.31845299590498843, 0.9432357974012783, -0.997251966037052, 0.2759123015839082, -0.44563828807987005, 0.0658892040986126, 0.8889417755601342, -0.37494209877743034, -0.7809523812297717, -0.4143610249947685, -0.07701579463686181, -0.16931970343074226, 0.4876580431067592, -0.7292721336622829, -0.5202665398656188, -0.5575028719935992, -0.8827014738002428, 0.3944267992036667, -0.6625446326491208, -0.39495512417039935, -0.5505441415386224, 0.7603058631237196, 0.5491791033743902, 0.4956907935903329, -0.6406432171386762, 0.5595595265298355, 0.21283870530601934, -0.24790316844144114, -0.15348297647859882, 0.5397335394505292, -0.3505330661101617, -0.1366961248391555, -0.4796503061290045, -0.040885590325706565, 0.5774290439195952, 0.6624520337936849, -0.242163665192497, 0.017360716800909157, 0.6767048086255922, -0.2535255820930627, -0.10611905462034509, -0.30583336640803016, -0.18692068039344364, -0.7228789500394884, -0.15041831248093007, -0.31787901752196873, -0.9133444744391289, 0.1581444735765789, 0.5479515300010369, 0.6460026252974257, 0.3103226990910665, -0.3819395035165865, 0.4801521259696343, 0.30906245176826763, -0.5184829344377707, 0.25529117982408933, 0.19253404550422767, 0.19539343160859055, -0.719517718511419, 0.45786113117278227, 0.9651454529888847, 0.04319219360251458, -0.3723679106735763, -0.14248342599284536, -0.9394053856138842, 0.23455021005558296, -0.42297945719024027, -0.3637779086723889, -0.09199856017058854, 0.21384895127709774, -0.695048566392348, -0.8022492116498268, -0.029433564265571508, 0.09190001787934281, -0.7911853198004833, 0.5606548583639683, -0.7794129022163729, 0.1896311738778036, 0.5023522061240359, -0.12146998658404085, 0.03512461635898049, -0.36248222370045113, -0.7128113102181357, -0.4115102319658804, 0.09000169239453656, -0.006535465213737296, 0.636192540860576, 0.2703815604437562, -0.9535803570266831, 0.10416344608751832, 0.0221519708271877, -0.7541577112213684, -0.9553978612082281, 0.7382470044071141, 0.5331423552630082, -0.2556529766511726, -0.7553819745840443, 0.3984013564217546, -0.793797634458345, 0.0020368412744822817, -0.19486288622192888, -0.08680682446298377, 0.5361512361999079, -0.6530921361286284, 0.6254711228711497, -0.8052065612118278, -0.5706092331817334, -0.1277257067902088, -0.04944853656465125, 0.07050569004548463, -0.08266720733797134, 0.5225884661160256, -0.8380226568070136, -0.6440559883133756, 0.016821209645259228, -0.5554036177115808, 0.7775842646518512, -0.378773468521123, 0.46614084016377416, 0.46011037277840156, -0.02095517850004988, 0.014866116314120291, 0.893317333474324, -0.2930625233486394, 0.13645104319765666, 0.9867291465267847, -0.18855333414429126, 0.9731108666289987, -0.4585662631527023, -0.14526887866289354, 0.9207558362541829, -0.5530960503865824, -0.35323136569033775, -0.8091326141322264, 0.5081710829177328, -0.24410704949454928, -0.6962456208913184, -0.3240442125464918, 0.5519471582483013, 0.2682633042475757, -0.47126237561976647, -0.6172870888574647, -0.49384730678653654, -0.8747732737298256, -0.24423093823538566, -0.4589287374934508, 0.7987029876314691, 0.44351730955290125, 0.3607721093309477, 0.7219598116825381, 0.8548089303771664, -0.6287379831558287, -0.5940398638201767, -0.2559926900095082, -0.9144689066294994, 0.09020674436839854, 0.4516625728529641, 0.8574237880486242, -0.3939702948490671, 0.1948043022350843, -0.517398194843114, 0.7651233808430404, 0.4090210853529712, 0.4385859867710282, 0.1770516199831783, -0.12768343034681248, 0.03378729211075034, 0.49293453844642166, -0.4645408674894901, 0.15823505491778564, -0.024247850231038624, 0.2800161942800665, 0.5342539519318238, -0.02781811760909308, 0.24938165339799434, 0.14920230447132907, 0.7673987604934138, -0.5993743951734938, 0.9803080722759462, 0.9525718657314085, -0.21567244058895202, 0.3672524317523529, 0.11910419424499682, 0.6097810641107471, 0.15662495537426352, -0.3962674662282148, -0.727903348944396, -0.8470201074190399, 0.6492585194029039, -0.45524687906255795, -0.41934533430284154, -0.4975065200410506, 0.07467130193880143, 0.1840571669043387, 0.383850844872239, 0.29166203096787424, -0.07713782901486549, -0.12197175960106271, -0.9136392791805382, -0.4994379715496388, 0.5749826664005232, -0.3768182367898049, 0.19378110510027088, 0.8611292426015756, 0.3063525839331152, 0.9282762030349889, 0.3857606221522376, 0.25385052426334764, 0.5741075291542919, 0.8387522978324056, -0.794972202421126, 0.2224101058026392, -0.2805283433649408, 0.3022443671968978, -0.5916401851411942, -0.7997336615736242, 0.46049928117513844, -0.20193855217435985, 0.5784035439548751, -0.6298392674292476, 0.10290214144098425, -0.18492001629439792, 0.3658989641640407, -0.40009606937974757, 0.6118755088512802, 0.647509070091196, 0.4453464065225027, -0.03624704956746755, -0.6869220377880485, 0.33971026415821715, 0.16959328145099198, 0.7635792295232272, -0.606244768330982, -0.16529622817960826, 0.7418486713950967, 0.8164163911773631, 0.520658164168284, -0.713194582409076, -0.48621690629627057, -0.9811279660034451, -0.42726625543299646, 0.5125644784281507, -0.21341192554704405, -0.7751139320087422, -0.1520674113630484, 0.9900929018920466, 0.273616342066078, -0.2399435570984217, -0.5070441723435835, -0.4454065401652092, 0.3668691958352436, 0.3325319830833254, -0.6519783139276889, 0.7621458383007763, -0.08460871589327748, 0.22098364124446726, -0.9029317933914349, -0.30311589986251913, -0.8295222538135857, -0.28604367656913815, 0.009156096972981444, 0.5897086809307996, -0.2211648220396536, 0.40018945677598444, 0.8170586450517268, -0.03524262494206908, -0.45268254077029585, 0.7573458261186684, -0.0760520389071884, -0.83199183016653, 0.5338863746638289, -0.742576509046607, 0.5740138526693198, -0.2993527092515288, -0.2866619900972646, -0.8852827776567537, 0.7833733504852535, 0.20525789687598806, -0.5241508266660158, 0.7631621420902944, 0.9418848976996346, 0.25436816336950113, 0.6655704953106885, -0.1149308230361075, -0.43130207533144654, -0.5550682526885051, 0.7016660149131739, 0.8831119213558477, -0.47431534095651695, -0.47513726292817055, 0.5075453913337524, -0.15395433952256854, 0.0492722249740384, -0.515920814813431, 0.8497854763491274, -0.7667399634647162, -0.13789437769287005, -0.4824966144818951, 0.6525829891823649, 0.9628355471004308, 0.9141067330428766, -0.7526677469395433, 0.2461938333883471, 0.8474143243978315, 0.9446480191434738, 0.6674528881499772, -0.32082208221078934, -0.005580466421454399, 0.5144171263364835, 0.4697839335005144, 0.5801640236088632, 0.5132690707631337, 0.2902365932300347, 0.7387079421524091, -0.005165574434690497, 0.2697157503827543, -0.6593517306597789, -0.16897610388942869, -0.34490579069599525, 0.18706931702556628, -0.9688513410944912, -0.8706685040352056, -0.2736910650318535, 0.8821874505910405, 0.17893925023211843, -0.3325117651075541, 0.24027722688016484, 0.9068189279204028, -0.4234459917509682, -0.666889314699771, -0.966976286326186, 0.9227509700625451, -0.9149174703153053, 0.19886887305803533, 0.7099401866637229, 0.7793642936872561, 0.4248408063631499, 0.16816742268153334, 0.2028662463208259, -0.4428611110583812, 0.46640230515539477, -0.8806625941823261, 0.5500637774626925, 0.866224592523219, -0.18901339388754332, -0.33017142694186896, 0.9745518140061913, 0.8427063508634802, -0.08089091107275691, -0.6505692750203831]

network.set_weights(best)

env = gym.make('Pendulum', render_mode='human')

observation = env.reset()
action = [float(network.predict((observation[0])))]
coun = 1

while True:
    while True:
        env.render()
        observation, reward, done, _, info = env.step(action)

        if done or keyboard.is_pressed('Space'):
            break

        time.sleep(0.03)
        action = [float(network.predict(observation))]
        print(action)
    env.reset()
    print("It`s", coun)
    coun += 1

env.close()
